# EarthLord - 产品需求文档 (PRD)

## 文档信息
- **产品名称**: EarthLord (地球领主)
- **文档版本**: v1.0
- **更新日期**: 2025-12-24
- **产品定位**: 基于LBS的末日生存探索游戏
- **目标平台**: iOS (全球175个国家和地区)

---

## 1. 产品概述

### 1.1 产品背景
EarthLord是一款结合现实世界GPS定位和末日生存主题的创新型移动游戏。玩家通过现实中的步行移动来圈占领地、探索废墟、收集资源、建造家园,并与其他玩家进行交易和社交互动。

### 1.2 产品愿景
在末日废土的背景下,通过"希望朋克"的视觉风格,为玩家提供一个重建文明、探索世界、社交互动的沉浸式游戏体验,同时鼓励玩家进行现实世界的户外活动。

### 1.3 世界观设定
- **时间背景**: 2051年,终末战争后3年
- **核心设定**: 《新开拓者协议》- "凡以双足丈量之无主土地,皆为开拓者所有"
- **视觉风格**: 希望朋克 - 废土之上的新生,绝望中的希望

### 1.4 核心游戏循环
```
登录注册 → 圈地占领 → 探索搜刮 → 获得资源
    ↑                              ↓
    │         建造建筑(消耗资源)      │
    │         交易换物(流通资源)      │
    │         生存消耗(食物/水)       │
    │                              ↓
    └──────── 通讯社交 ← 成就排行 ← 发展壮大
```

---

## 2. 目标用户

### 2.1 核心用户画像
- **年龄段**: 18-35岁
- **兴趣**: 喜欢户外活动、探索、收集、策略游戏
- **特征**:
  - 有一定户外活动习惯
  - 对地理位置游戏(如宝可梦GO)感兴趣
  - 喜欢末日/生存题材
  - 愿意为游戏体验付费

### 2.2 用户需求
- 需要一款能够激励户外运动的游戏
- 希望游戏与现实世界产生互动
- 寻求社交和竞争体验
- 追求收集和成就感

---

## 3. 核心功能需求

### 3.1 第一部分:登录与圈地系统

#### 3.1.1 用户认证系统
**优先级**: P0 (必须有)

**功能描述**:
- 支持邮箱注册/登录
- 支持Apple ID一键登录
- 支持Google账号登录
- 会话管理和多设备登录
- 密码找回功能

**技术要求**:
- 使用Supabase Auth服务
- OAuth 2.0协议
- 安全的令牌存储

**验收标准**:
- 用户可以通过3种方式成功注册/登录
- 登录状态在app重启后保持
- 支持账号切换

---

#### 3.1.2 GPS圈地系统
**优先级**: P0 (必须有)

**功能描述**:
- 实时GPS定位跟踪
- 绘制用户行走轨迹
- 自动检测轨迹闭合
- 验证圈地合法性(无重叠、面积限制)
- 将合法领地永久保存

**技术要求**:
- 使用Apple MapKit
- CoreLocation框架
- PostGIS地理数据库
- 多边形计算和验证算法

**业务规则**:
- 最小圈地面积: 500m²
- 最大圈地面积: 100,000m²
- 轨迹点间隔: 5-10米
- 闭合判定距离: 20米内

**验收标准**:
- GPS定位精度在10米以内
- 轨迹实时显示在地图上
- 自动识别闭合并计算面积
- 拒绝与他人重叠的领地
- 合法领地永久保存到云端

---

#### 3.1.3 领地管理系统
**优先级**: P0 (必须有)

**功能描述**:
- 查看领地列表
- 领地详情展示(名称、面积、建筑数量)
- 领地重命名
- 领地交易开关设置
- 领地数据实时同步

**数据结构**:
```
Territory {
  id: UUID
  owner_id: UUID
  name: String
  geometry: Polygon
  area: Float
  created_at: Timestamp
  allow_trading: Boolean
  buildings: [Building]
}
```

**验收标准**:
- 可以查看所有拥有的领地
- 可以自定义领地名称
- 可以开启/关闭交易功能
- 数据变更实时同步

---

### 3.2 第二部分:探索与资源获取

#### 3.2.1 POI发现与搜刮系统
**优先级**: P0 (必须有)

**功能描述**:
- 基于GPS位置自动发现附近POI
- 地理围栏触发机制(100米范围)
- 不同类型POI产出对应资源
- 探索冷却机制(同一POI 24小时内只能搜刮一次)
- 探索记录和统计

**POI资源映射**:
| POI类型 | 产出资源 |
|---------|----------|
| 医院/药店 | 药品、急救包 |
| 超市/餐厅 | 食物、饮用水 |
| 工厂/工地 | 金属、钢材 |
| 公园/林地 | 木材、植物纤维 |
| 银行/珠宝店 | 稀有材料、货币 |

**技术要求**:
- Apple MapKit POI数据
- 地理围栏(Geofencing)
- 冷却时间管理

**验收标准**:
- 进入100米范围内触发发现提示
- 搜刮后获得对应类型资源
- 24小时内不可重复搜刮同一POI
- 探索距离和时长正确统计

---

#### 3.2.2 背包/库存系统
**优先级**: P0 (必须有)

**功能描述**:
- 物品存储和管理
- 背包容量限制
- 物品分类显示
- 物品使用功能
- 本地优先存储,云端同步

**数据结构**:
```
Inventory {
  user_id: UUID
  capacity: Int (default: 100)
  items: [InventoryItem]
}

InventoryItem {
  item_id: UUID
  item_type: String
  quantity: Int
  acquired_at: Timestamp
}
```

**验收标准**:
- 可以查看所有拥有的物品
- 容量达到上限时提示
- 离线状态下仍可查看
- 网络恢复后自动同步

---

### 3.3 第三部分:建造与交易系统

#### 3.3.1 建造系统
**优先级**: P0 (必须有)

**功能描述**:
- 浏览建筑模板库(15种建筑)
- 建筑分类:生存、储存、生产、能源
- 资源检查和消耗
- 建筑位置放置(仅限自己领地内)
- 建筑升级系统

**建筑分级**:
- Tier 1: 基础生存设施(篝火、庇护所)
- Tier 2: 功能扩展设施(仓库、农田)
- Tier 3: 高级设施(太阳能板、风力发电)

**业务规则**:
- 建筑只能放置在自己的领地内
- 建造消耗对应资源
- 资源不足无法建造
- 每个领地建筑数量上限:50

**验收标准**:
- 可以浏览所有建筑模板
- 资源足够时可以成功建造
- 资源不足时给出提示
- 建筑正确显示在领地上

---

#### 3.3.2 建筑状态管理
**优先级**: P1 (重要)

**功能描述**:
- 建筑状态机管理
- 建筑激活/停用
- 建筑升级
- 建筑维修
- 建筑拆除

**状态流转**:
```
建造中 → 待激活 → 运行中 → 损坏
                   ↓
                  升级中
```

**验收标准**:
- 不同状态下显示对应UI
- 状态流转符合业务规则
- 只能对激活状态的建筑进行升级

---

#### 3.3.3 玩家交易系统
**优先级**: P1 (重要)

**功能描述**:
- 发布交易挂单(以物易物)
- 查看附近玩家的交易列表
- 接受/拒绝交易
- 交易历史记录
- 基于位置的交易可见性(100米范围)

**业务规则**:
- 必须在交易开放的领地100米范围内
- 交易双方资源实时扣除和增加
- 交易完成后挂单自动下架

**验收标准**:
- 可以发布交易挂单
- 只能看到100米范围内的交易
- 交易成功后资源正确转移
- 交易历史可查询

---

### 3.4 第四部分:通讯系统

#### 3.4.1 消息中心
**优先级**: P1 (重要)

**功能描述**:
- 系统消息推送
- 生存指南
- 每日任务通知
- 官方公告

**验收标准**:
- 新消息实时推送
- 消息按时间排序
- 可以标记已读

---

#### 3.4.2 公共频道聊天
**优先级**: P1 (重要)

**功能描述**:
- 基于位置的公共聊天室
- 覆盖范围:3公里
- 实时消息推送
- 消息历史记录

**技术要求**:
- Supabase Realtime
- 地理位置过滤

**验收标准**:
- 消息秒级送达
- 只能看到3km范围内的消息
- 支持文本消息

---

#### 3.4.3 频道管理系统
**优先级**: P2 (可选)

**功能描述**:
- 创建私人频道
- 加入/退出频道
- 频道列表展示
- 频道内聊天

**验收标准**:
- 可以创建频道并邀请成员
- 可以浏览附近的频道
- 频道消息独立存储

---

#### 3.4.4 PTT对讲机功能
**优先级**: P2 (可选)

**功能描述**:
- 长按发送语音消息
- 公共频道语音广播
- 设备等级限制功能

**设备等级**:
- 收音机:只能接收
- 对讲机:可以收发(3km)
- 营地电台:10km范围
- 卫星通讯:全球范围

**验收标准**:
- 长按可以录制语音
- 松开自动发送
- 不同设备有不同功能限制

---

### 3.5 第五部分:个人中心与商业化

#### 3.5.1 个人主页
**优先级**: P0 (必须有)

**功能描述**:
- 玩家档案展示
- 存活天数统计
- 领地数量和面积
- 建筑统计
- 探索统计

**验收标准**:
- 所有数据实时更新
- 统计数据准确

---

#### 3.5.2 多语言支持
**优先级**: P0 (必须有)

**支持语言**:
- 简体中文
- 繁体中文
- English

**验收标准**:
- 切换语言后所有UI更新
- 文本翻译准确无误

---

#### 3.5.3 内购/订阅系统
**优先级**: P0 (必须有)

**功能描述**:
- 订阅制会员
- 一次性资源包购买
- StoreKit 2集成
- 购买记录管理

**商品设置**:

订阅商品:
- 开拓者月卡: $9.99/月
- 领主通行证: $19.99/月

一次性购买:
- 初级物资包: $0.99
- 中级物资包: $2.99
- 高级物资包: $4.99
- 稀有资源包: $9.99

**验收标准**:
- 可以正常购买和订阅
- 购买成功后权益立即生效
- 支持恢复购买
- 支持家庭共享

---

#### 3.5.4 排行榜系统
**优先级**: P1 (重要)

**功能描述**:
- 领地面积排行榜
- 探索废墟排行榜
- 建筑数量排行榜
- 个人排名查询

**技术要求**:
- 数据库窗口函数
- 缓存机制(5分钟更新)

**验收标准**:
- 排行榜数据准确
- 个人排名正确显示
- 查询响应时间<1秒

---

#### 3.5.5 成就系统
**优先级**: P1 (重要)

**功能描述**:
- 成就任务列表
- 成就进度跟踪
- 成就奖励发放
- 成就稀有度分级

**成就分类**:
- 新手成就(引导)
- 进阶成就
- 稀有成就
- 传说成就

**技术实现**:
- EventBus事件驱动
- 发布-订阅模式

**验收标准**:
- 完成条件触发后自动解锁
- 奖励正确发放
- 进度准确显示

---

#### 3.5.6 生存体征系统
**优先级**: P1 (重要)

**功能描述**:
- 核心生命值管理
- 饱食度系统(每小时-5)
- 水分系统(每小时-10)
- 状态增益机制
- 时间衰减机制

**业务规则**:
- 饱食度/水分>80%: 获得增益
- 饱食度/水分<20%: 开始掉血
- 核心生命归零: 角色死亡

**验收标准**:
- 数值随时间正确衰减
- 低于阈值时触发惩罚
- 可以通过消耗物品恢复

---

## 4. 技术需求

### 4.1 技术栈
- **前端**: SwiftUI, UIKit
- **地图服务**: Apple MapKit
- **定位服务**: CoreLocation
- **后端**: Supabase (BaaS)
- **数据库**: PostgreSQL + PostGIS
- **实时通讯**: Supabase Realtime
- **认证**: Supabase Auth
- **支付**: StoreKit 2
- **存储**: 本地SQLite + 云端PostgreSQL

### 4.2 性能要求
- App启动时间: <3秒
- GPS定位响应: <2秒
- 地图加载时间: <1秒
- 消息推送延迟: <1秒
- API响应时间: <500ms
- 离线功能: 支持基础功能离线使用

### 4.3 数据安全
- 用户密码加密存储
- HTTPS加密传输
- OAuth安全认证
- 支付数据加密
- 用户隐私保护

### 4.4 兼容性
- iOS 15.0+
- iPhone 8及以上设备
- 支持iPhone和iPad

---

## 5. 商业模式

### 5.1 变现方式
1. **订阅制会员** (主要收入)
   - 开拓者月卡: $9.99/月
   - 领主通行证: $19.99/月

2. **一次性内购** (辅助收入)
   - 资源包购买
   - 特殊道具购买

3. **未来扩展**:
   - 广告变现(免费用户)
   - 赛季通行证
   - NFT土地交易(Web3方向)

### 5.2 用户增长策略
- 邀请好友奖励
- 社交分享激励
- 排行榜竞争
- 限时活动
- 联盟系统

---

## 6. 数据分析需求

### 6.1 核心指标
- DAU/MAU (日活/月活)
- 留存率(次日、7日、30日)
- ARPU/ARPPU
- 付费转化率
- 功能使用率

### 6.2 用户行为追踪
- 圈地行为(频率、面积)
- 探索行为(POI类型、距离)
- 社交行为(聊天、交易)
- 付费行为(商品、金额)

---

## 7. 版本规划

### 7.1 MVP版本 (v1.0)
- 登录注册系统
- GPS圈地系统
- 领地管理
- POI探索
- 背包系统
- 建造系统
- 内购系统

### 7.2 v1.1版本
- 交易系统
- 公共频道
- 排行榜
- 成就系统

### 7.3 v1.2版本
- 频道管理
- PTT对讲
- 生存体征
- 联盟系统

### 7.4 v2.0版本
- PVP对抗
- 联盟战争
- 世界事件
- Web3集成

---

## 8. 风险与挑战

### 8.1 技术风险
- GPS定位精度问题
- 地理数据计算性能
- 实时通讯稳定性
- 电池消耗优化

### 8.2 业务风险
- 用户活跃度不足
- 付费转化率低
- 恶意圈地行为
- 作弊防范

### 8.3 合规风险
- 地图数据使用合规
- 用户隐私保护
- 未成年人保护
- 各国法律法规差异

---

## 9. 附录

### 9.1 术语表
- **LBS**: Location Based Service, 基于位置的服务
- **POI**: Point of Interest, 兴趣点
- **BaaS**: Backend as a Service, 后端即服务
- **ARPU**: Average Revenue Per User, 每用户平均收入
- **DAU**: Daily Active Users, 日活跃用户

### 9.2 参考竞品
- 宝可梦GO
- Ingress
- Pikmin Bloom
- Coin Hunt World

---

**文档结束**
